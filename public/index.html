<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- MODIFICATION: Added user-scalable=no to prevent pinch-zooming -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Alphabet & Word Learning App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f0f8ff;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px 0;
      
      /* --- MODIFICATION: Prevent accidental text selection and callouts --- */
      -webkit-user-select: none; /* Safari */
      -ms-user-select: none;     /* IE 10+ */
      user-select: none;         /* Standard */
      -webkit-touch-callout: none; /* Disable callout on long press (e.g., save image) */
    }

    .modal-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex; justify-content: center; align-items: center;
      z-index: 200;
    }
    .modal-content {
      background-color: white; padding: 30px 40px; border-radius: 15px;
      text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .modal-content h2 { margin-top: 0; color: #333; }
    .modal-content button {
      display: block; width: 100%; padding: 15px 30px; font-size: 18px;
      cursor: pointer; border: 2px solid #007bff; background-color: white;
      color: #007bff; border-radius: 8px; margin-top: 15px;
      transition: background-color 0.3s, color 0.3s;
    }
    .modal-content button:hover { background-color: #007bff; color: white; }

    .mode-container {
      width: 100%; display: none; flex-direction: column; align-items: center;
    }
    .box-container {
      display: flex; justify-content: center; flex-wrap: wrap; gap: 20px;
    }
    .box {
      width: 100px; height: 100px; background-image: url('https://img.icons8.com/color/96/gift.png');
      background-size: cover; background-position: center; border: none;
      border-radius: 10px; display: flex; align-items: center; justify-content: center;
      cursor: pointer; position: relative; overflow: hidden;
    }
    .box.open { background-image: none; }
    .letter {
      font-size: 3rem; font-weight: bold; color: #000; display: none;
      animation: pop-in 0.5s ease forwards;
    }
    .box.open .letter { display: block; }
    @keyframes pop-in {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .restart-btn {
      margin-top: 10px; padding: 10px 20px; font-size: 16px; background-color: #4caf50;
      color: white; border: none; border-radius: 5px; cursor: pointer;
    }
    .restart-btn:hover { background-color: #45a049; }
    .settings-btn {
      margin-top: 10px; padding: 8px 15px; font-size: 14px; background-color: #007bff;
      color: white; border: none; border-radius: 5px; cursor: pointer;
    }
    .settings-btn:hover { background-color: #0056b3; }
    .font-settings { display: none; margin-top: 20px; }
    .font-settings label { margin-right: 10px; }
    .image-container {
      margin-top: 20px; min-height: 160px; max-width: 100%; display: flex;
      flex-direction: column; align-items: center;
    }
    .image-container img {
      max-width: 150px; border: 2px solid #ddd; border-radius: 10px;
      padding: 5px; background-color: white;
    }
    
    /* --- WRITING MODE STYLES --- */
    #wordSelectionContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      padding: 20px;
      max-width: 600px;
    }
    .word-thumbnail {
      width: 80px;
      height: 80px;
      border: 2px solid #ddd;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, border-color 0.2s;
      background-color: white;
      padding: 5px;
    }
    .word-thumbnail:hover {
      transform: scale(1.05);
      border-color: #007bff;
    }
    .word-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 5px;
    }
    
    #writingGameContainer {
      display: none;
      flex-direction: column;
      align-items: center;
    }
    #wordImageContainer {
      min-height: 160px; display: flex; align-items: center; justify-content: center;
    }
    #wordImageContainer img {
      max-width: 150px; border: 2px solid #ddd; border-radius: 10px;
      padding: 5px; background-color: white;
    }
    #wordFormationContainer { display: flex; gap: 10px; height: 60px; margin-top: 10px; }
    .letter-placeholder {
      width: 50px; height: 50px; border: 2px dashed #ccc; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 2rem; font-weight: bold;
      transition: background-color 0.2s, border-color 0.2s;
    }
    .letter-placeholder.filled {
      border-color: #28a745; border-style: solid;
      background-color: #28a745; color: white;
    }
    #letterChoicesContainer {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 10px; padding: 10px; max-width: 500px;
    }
    .letter-choice {
      width: 50px; height: 50px; background-color: #007bff; color: white;
      border-radius: 10px; display: flex; align-items: center; justify-content: center;
      font-size: 2rem; font-weight: bold; cursor: pointer;
      transition: background-color 0.3s, transform 0.5s ease;
    }
    .letter-choice:hover { background-color: #0056b3; }
    .letter-choice.moving {
        transition: transform 0.5s ease-in-out;
        z-index: 100; background-color: #28a745;
    }
    .back-to-selection-btn {
        margin-top: 10px; padding: 10px 20px; font-size: 16px; background-color: #6c757d;
        color: white; border: none; border-radius: 5px; cursor: pointer;
    }
    .back-to-selection-btn:hover { background-color: #545b62; }
    .next-word-btn {
        margin-top: 10px; padding: 10px 20px; font-size: 16px; background-color: #4caf50;
        color: white; border: none; border-radius: 5px; cursor: pointer;
    }
    .next-word-btn:hover { background-color: #45a049; }

    /* --- ARITHMETIC MODE STYLES --- */
    #arithmeticProblem {
      font-size: 3rem;
      font-weight: bold;
      color: #333;
      margin: 20px 0;
    }
    
    .apples-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 30px;
      margin: 20px 0;
      min-height: 120px;
    }
    
    .apple-group {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .apple-group-label {
      font-size: 2rem;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
    }
    
    .apples-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 150px;
      gap: 5px;
    }
    
    .apple {
      width: 30px;
      height: 30px;
      background-color: #ff4444;
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      position: relative;
      margin: 2px;
    }
    
    .apple::before {
      content: '';
      position: absolute;
      top: -3px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 8px;
      background-color: #8B4513;
      border-radius: 2px;
    }
    
    .apple::after {
      content: '';
      position: absolute;
      top: -2px;
      right: 8px;
      width: 8px;
      height: 6px;
      background-color: #228B22;
      border-radius: 50%;
      transform: rotate(20deg);
    }
    
    #numberChoicesContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      padding: 20px;
      max-width: 400px;
    }
    
    .number-choice {
      width: 60px;
      height: 60px;
      background-color: #ff6b35;
      color: white;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      border: none;
    }
    
    .number-choice:hover {
      background-color: #e55a2b;
      transform: scale(1.05);
    }
    
    .number-choice.correct {
      background-color: #28a745;
      animation: correct-bounce 0.6s ease;
    }
    
    .number-choice.incorrect {
      background-color: #dc3545;
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes correct-bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
      20%, 40%, 60%, 80% { transform: translateX(8px); }
    }
    
    .letter-choice.incorrect {
        animation: shake 0.5s ease-in-out; background-color: #dc3545;
    }
    
    .next-problem-btn {
      margin-top: 20px;
      padding: 12px 25px;
      font-size: 18px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: none;
    }
    
    .next-problem-btn:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

  <div id="startupModal" class="modal-overlay">
    <div class="modal-content">
      <h2>Choose a Mode</h2>
      <button onclick="initializeMode('alphabet')">Learn Alphabet</button>
      <button onclick="initializeMode('writing')">Practice Writing</button>
      <button onclick="initializeMode('arithmetic')">Learn Arithmetic</button>
      <button onclick="initializeMode('digits')">Learn Digits</button>
    </div>
  </div>

  <div id="alphabetMode" class="mode-container">
    <div class="box-container" id="boxContainer"></div>
    <button class="settings-btn" onclick="toggleFontSettings()">Settings</button>
    <button class="restart-btn" onclick="resetBoxes()">Restart</button>
    <div class="font-settings" id="fontSettings">
      <div>
        <label for="fontSelector">Choose a font:</label>
        <select id="fontSelector" onchange="changeFont(this.value)">
          <option value="Arial">Arial</option>
          <option value="Comic Sans MS">Comic Sans MS</option>
          <option value="Verdana">Verdana</option>
        </select>
      </div>
      <div style="margin-top: 10px;">
        <label for="caseSelector">Letter Case:</label>
        <select id="caseSelector" onchange="changeCase(this.value)">
          <option value="uppercase">Uppercase</option>
          <option value="lowercase">Lowercase</option>
          <option value="mixed">Mixed</option>
        </select>
      </div>
    </div>
    <div class="image-container" id="imageContainer"></div>
  </div>

  <div id="writingMode" class="mode-container">
    <div id="wordSelectionContainer"></div>
    <div id="writingGameContainer">
      <div id="wordImageContainer"></div>
      <div id="wordFormationContainer"></div>
      <div id="letterChoicesContainer"></div>
      <button class="back-to-selection-btn" onclick="showWordSelection()">Back to Word Selection</button>
      <button class="next-word-btn" style="display: none;" onclick="showWordSelection()">Select Another Word</button>
    </div>
  </div>

  <div id="arithmeticMode" class="mode-container">
    <div id="arithmeticProblem"></div>
    <div class="apples-container" id="applesContainer"></div>
    <div id="numberChoicesContainer"></div>
    <button class="next-problem-btn" onclick="generateArithmeticProblem()">Next Problem</button>
    <button class="back-to-selection-btn" onclick="backToModeSelection()">Back to Menu</button>
  </div>

  <div id="digitsMode" class="mode-container">
    <div class="apples-container" id="digitsApplesContainer"></div>
    <div id="digitsNumberChoicesContainer"></div>
    <button class="next-problem-btn" onclick="generateDigitsProblem()">Next</button>
    <button class="back-to-selection-btn" onclick="backToModeSelection()">Back to Menu</button>
  </div>
  

  <script>

    /* --- ALPHABET MODE SCRIPT --- */
    const alphabet = 'ABCDEFGHIJKLMNOPRSTUWZ';
    let usedLetters = [];
    const letterToWordAndImage = {
      A: 'arbuz', B: 'banan', C: 'cytryna', D: 'dynia', E: 'everest', G: 'gruszka',
      H: 'helikopter', I: 'indyk', J: 'jablko', K: 'kot', L: 'lody', M: 'mama',
      N: 'noz', O: 'okno', P: 'pies', R: 'rower', S: 'slonce', T: 'tata', U: 'ul',
      W: 'warsztat', Z: 'zebra'
    };
    function getRandomLetter(caseType) {
      let availableLetters = alphabet.split('').filter(letter => !usedLetters.includes(letter));
      if (availableLetters.length === 0) {
        generateAlphabetBoxes();
        usedLetters = [];
        availableLetters = alphabet.split('');
      }
      let randomIndex = Math.floor(Math.random() * availableLetters.length);
      let letter = availableLetters[randomIndex];
      if (caseType === 'lowercase') letter = letter.toLowerCase();
      else if (caseType === 'mixed') letter = Math.random() > 0.5 ? letter.toLowerCase() : letter;
      usedLetters.push(letter.toUpperCase());
      return letter;
    }
    function openBox(box) {
      if (!box.classList.contains('open')) {
        const letter = getRandomLetter(document.getElementById('caseSelector').value);
        if (!letter) return;
        box.querySelector('.letter').textContent = letter.toUpperCase();
        box.classList.add('open');
        const letterKey = letter.toUpperCase();
        if (letterToWordAndImage[letterKey]) {
          displayImage(`img/${letterToWordAndImage[letterKey]}.jpeg`);
        }
        if (Array.from(document.querySelectorAll('.box')).every(b => b.classList.contains('open'))) {
          document.querySelector('.restart-btn').style.display = 'block';
        }
      }
    }
    function displayImage(image) { document.getElementById('imageContainer').innerHTML = `<img src="${image}" alt="">`; }
    function generateAlphabetBoxes() {
      const boxContainer = document.getElementById('boxContainer');
      boxContainer.innerHTML = '';
      for (let i = 0; i < 3; i++) {
        const boxDiv = document.createElement('div');
        boxDiv.className = 'box';
        boxDiv.onclick = function() { openBox(this); };
        boxDiv.appendChild(document.createElement('div')).className = 'letter';
        boxContainer.appendChild(boxDiv);
      }
    }
    function resetBoxes() {
      generateAlphabetBoxes();
      document.querySelector('#alphabetMode .restart-btn').style.display = 'none';
      document.getElementById('imageContainer').innerHTML = '';
    }
    function toggleFontSettings() {
      const fontSettings = document.getElementById('fontSettings');
      fontSettings.style.display = fontSettings.style.display === 'none' ? 'block' : 'none';
    }
    function changeFont(font) {
      document.querySelectorAll('.letter, .letter-placeholder, .letter-choice').forEach(el => el.style.fontFamily = font);
    }
    function changeCase(caseType) { resetBoxes(); }
    function preloadImages() {
      Object.values(letterToWordAndImage).forEach(word => {
        const img = new Image();
        img.src = `img/${word}.jpeg`;
      });
    }

    /* --- WRITING MODE SCRIPT --- */
    const fullAlphabet = 'ABCDEFGHIJKLMNOPRSTUWYZ';

    const writingWords = ['mama', 'tata', 'kot', 'pies', 'ul', 'zebra', 'arbuz', 'okno', 'rower', 'banan', 'auto', 'felek', 'adelka', 'lew', 'kwiatek'];
    let currentWritingWord = '';
    let discoveredLettersCount = 0;
    let isAnimating = false;

    function showWordSelection() {
      document.getElementById('wordSelectionContainer').style.display = 'flex';
      document.getElementById('writingGameContainer').style.display = 'none';
      
      // Generate thumbnails
      const container = document.getElementById('wordSelectionContainer');
      container.innerHTML = '';
      
      writingWords.forEach(word => {
        const thumbnail = document.createElement('div');
        thumbnail.className = 'word-thumbnail';
        thumbnail.onclick = () => selectWord(word);
        
        const img = document.createElement('img');
        img.src = `img/${word}.jpeg`;
        img.alt = word;
        img.onerror = function() {
          // If image fails to load, show a placeholder
          this.style.display = 'none';
          thumbnail.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 12px; color: #666;">${word}</div>`;
        };
        
        thumbnail.appendChild(img);
        container.appendChild(thumbnail);
      });
    }

    function selectWord(word) {
      currentWritingWord = word.toUpperCase();
      startWritingGame();
    }

    function startWritingGame() {
      document.getElementById('wordSelectionContainer').style.display = 'none';
      document.getElementById('writingGameContainer').style.display = 'flex';
      
      isAnimating = false;
      document.querySelector('#writingMode .next-word-btn').style.display = 'none';
      discoveredLettersCount = 0;
      
      const imagePath = `img/${currentWritingWord.toLowerCase()}.jpeg`;
      document.getElementById('wordImageContainer').innerHTML = `<img src="${imagePath}" alt="${currentWritingWord}">`;
      
      const formationContainer = document.getElementById('wordFormationContainer');
      formationContainer.innerHTML = '';
      currentWritingWord.split('').forEach((_, i) => {
        const placeholder = document.createElement('div');
        placeholder.className = 'letter-placeholder';
        placeholder.id = `placeholder-${i}`;
        formationContainer.appendChild(placeholder);
      });
      
      generateLetterChoices();
    }

    function generateLetterChoices() {
      const correctLetters = currentWritingWord.toUpperCase().split('');
      const incorrectLettersCount = correctLetters.length;
      let incorrectLetters = [];
      while (incorrectLetters.length < incorrectLettersCount) {
        const randomLetter = fullAlphabet[Math.floor(Math.random() * fullAlphabet.length)];
        if (!correctLetters.includes(randomLetter) && !incorrectLetters.includes(randomLetter)) {
          incorrectLetters.push(randomLetter);
        }
      }
      let choices = [...correctLetters, ...incorrectLetters].sort(() => Math.random() - 0.5);
      const choicesContainer = document.getElementById('letterChoicesContainer');
      choicesContainer.innerHTML = '';
      choices.forEach(letter => {
        const choiceEl = document.createElement('div');
        choiceEl.className = 'letter-choice';
        choiceEl.textContent = letter;
        choiceEl.onclick = () => selectLetterChoice(choiceEl);
        choicesContainer.appendChild(choiceEl);
      });
      changeFont(document.getElementById('fontSelector').value);
    }

    function selectLetterChoice(letterEl) {
      if (isAnimating) return;
      const selectedLetter = letterEl.textContent;
      if (selectedLetter === currentWritingWord[discoveredLettersCount]) {
        isAnimating = true;
        const placeholder = document.getElementById(`placeholder-${discoveredLettersCount}`);
        const placeholderRect = placeholder.getBoundingClientRect();
        const letterRect = letterEl.getBoundingClientRect();
        
        letterEl.classList.add('moving');
        letterEl.style.position = 'fixed';
        letterEl.style.top = `${letterRect.top}px`;
        letterEl.style.left = `${letterRect.left}px`;
        
        requestAnimationFrame(() => {
          const newX = placeholderRect.left - letterRect.left;
          const newY = placeholderRect.top - letterRect.top;
          letterEl.style.transform = `translate(${newX}px, ${newY}px)`;
        });

        setTimeout(() => {
          placeholder.textContent = selectedLetter;
          placeholder.classList.add('filled');
          letterEl.remove();
          discoveredLettersCount++;
          isAnimating = false;
          if (discoveredLettersCount === currentWritingWord.length) {
            document.querySelector('#writingMode .next-word-btn').style.display = 'inline-block';
          }
        }, 500);
      } else {
        letterEl.classList.add('incorrect');
        setTimeout(() => letterEl.classList.remove('incorrect'), 500);
      }
    }

    /* --- ARITHMETIC MODE SCRIPT --- */
    let currentNum1, currentNum2, correctAnswer;
    let isArithmeticAnimating = false;

    function generateArithmeticProblem() {
      // Reset UI state
      document.querySelector('.next-problem-btn').style.display = 'none';
      isArithmeticAnimating = false;
      
      // Generate two random numbers that sum to less than 10
      currentNum1 = Math.floor(Math.random() * 5) + 1; // 1-5
      const maxNum2 = Math.min(5, 9 - currentNum1); // Ensure sum < 10
      currentNum2 = Math.floor(Math.random() * maxNum2) + 1; // 1 to maxNum2
      correctAnswer = currentNum1 + currentNum2;
      
      // Display the problem
      document.getElementById('arithmeticProblem').innerHTML = `${currentNum1} + ${currentNum2} = ?`;
      
      // Generate apple visuals
      generateApples();
      
      // Generate number choices (1-9)
      generateNumberChoices();
    }

    function generateApples() {
      const container = document.getElementById('applesContainer');
      container.innerHTML = '';
      
      // Create first group of apples
      const group1 = document.createElement('div');
      group1.className = 'apple-group';
      
      const label1 = document.createElement('div');
      label1.className = 'apple-group-label';
      label1.textContent = currentNum1;
      group1.appendChild(label1);
      
      const applesRow1 = document.createElement('div');
      applesRow1.className = 'apples-row';
      for (let i = 0; i < currentNum1; i++) {
        const apple = document.createElement('div');
        apple.className = 'apple';
        applesRow1.appendChild(apple);
      }
      group1.appendChild(applesRow1);
      
      // Plus sign
      const plusSign = document.createElement('div');
      plusSign.style.fontSize = '3rem';
      plusSign.style.fontWeight = 'bold';
      plusSign.style.color = '#333';
      plusSign.style.alignSelf = 'center';
      plusSign.textContent = '+';
      
      // Create second group of apples
      const group2 = document.createElement('div');
      group2.className = 'apple-group';
      
      const label2 = document.createElement('div');
      label2.className = 'apple-group-label';
      label2.textContent = currentNum2;
      group2.appendChild(label2);
      
      const applesRow2 = document.createElement('div');
      applesRow2.className = 'apples-row';
      for (let i = 0; i < currentNum2; i++) {
        const apple = document.createElement('div');
        apple.className = 'apple';
        applesRow2.appendChild(apple);
      }
      group2.appendChild(applesRow2);
      
      container.appendChild(group1);
      container.appendChild(plusSign);
      container.appendChild(group2);
    }

    function generateNumberChoices() {
      const container = document.getElementById('numberChoicesContainer');
      container.innerHTML = '';
      
      for (let i = 1; i <= 9; i++) {
        const choice = document.createElement('button');
        choice.className = 'number-choice';
        choice.textContent = i;
        choice.onclick = () => selectNumberChoice(choice, i);
        container.appendChild(choice);
      }
    }

    function selectNumberChoice(choiceEl, selectedNumber) {
      if (isArithmeticAnimating) return;
      
      isArithmeticAnimating = true;
      
      if (selectedNumber === correctAnswer) {
        choiceEl.classList.add('correct');
        setTimeout(() => {
          document.querySelector('.next-problem-btn').style.display = 'inline-block';
          isArithmeticAnimating = false;
        }, 600);
      } else {
        choiceEl.classList.add('incorrect');
        setTimeout(() => {
          choiceEl.classList.remove('incorrect');
          isArithmeticAnimating = false;
        }, 500);
      }
    }

    function initializeArithmeticMode() {
      generateArithmeticProblem();
    }

    /* --- DIGITS MODE SCRIPT --- */
    let currentDigit, isDigitsAnimating = false;

    function generateDigitsProblem() {
	// reset
	document.querySelector('#digitsMode .next-problem-btn').style.display = 'none';
	isDigitsAnimating = false;

	// pick random number 1â€“9
	currentDigit = Math.floor(Math.random() * 9) + 1;

	// draw apples
	const container = document.getElementById('digitsApplesContainer');
	container.innerHTML = '';
	const applesRow = document.createElement('div');
	applesRow.className = 'apples-row';
	for (let i = 0; i < currentDigit; i++) {
	    const apple = document.createElement('div');
	    apple.className = 'apple';
	    applesRow.appendChild(apple);
	}
	container.appendChild(applesRow);

	// generate 1 correct + 3 random wrong answers
	let choices = [currentDigit];
	while (choices.length < 4) {
	    const n = Math.floor(Math.random() * 9) + 1;
	    if (!choices.includes(n)) choices.push(n);
	}
	choices.sort(() => Math.random() - 0.5);

	const choicesContainer = document.getElementById('digitsNumberChoicesContainer');
	choicesContainer.innerHTML = '';
	choices.forEach(n => {
	    const btn = document.createElement('button');
	    btn.className = 'number-choice';
	    btn.textContent = n;
	    btn.onclick = () => selectDigitsChoice(btn, n);
	    choicesContainer.appendChild(btn);
	});
    }

    function selectDigitsChoice(btn, n) {
	if (isDigitsAnimating) return;
	isDigitsAnimating = true;
	if (n === currentDigit) {
	    btn.classList.add('correct');
	    setTimeout(() => {
		document.querySelector('#digitsMode .next-problem-btn').style.display = 'inline-block';
		isDigitsAnimating = false;
	    }, 600);
	} else {
	    btn.classList.add('incorrect');
	    setTimeout(() => {
		btn.classList.remove('incorrect');
		isDigitsAnimating = false;
	    }, 500);
	}
    }

    function initializeDigitsMode() {
	generateDigitsProblem();
    }


    /* --- MODE INITIALIZATION LOGIC --- */
    function initializeMode(mode) {
	const modal = document.getElementById('startupModal');
	modal.style.display = 'none';

	// Hide all modes first
	document.getElementById('alphabetMode').style.display = 'none';
	document.getElementById('writingMode').style.display = 'none';
	document.getElementById('arithmeticMode').style.display = 'none';
	document.getElementById('digitsMode').style.display = 'none'; // NEW


	if (mode === 'alphabet') {
            document.getElementById('alphabetMode').style.display = 'flex';
            resetBoxes();
	} else if (mode === 'writing') {
            document.getElementById('writingMode').style.display = 'flex';
            showWordSelection();
	} else if (mode === 'arithmetic') {
            document.getElementById('arithmeticMode').style.display = 'flex';
            initializeArithmeticMode();
	} else if (mode === 'digits') {                // NEW
	    document.getElementById('digitsMode').style.display = 'flex';
	    initializeDigitsMode();
	}
    }

    function backToModeSelection() {
      // Hide all modes
      document.getElementById('alphabetMode').style.display = 'none';
      document.getElementById('writingMode').style.display = 'none';
      document.getElementById('arithmeticMode').style.display = 'none';
      
      // Show modal
      document.getElementById('startupModal').style.display = 'flex';
    }

    // --- Initial Load ---
    document.addEventListener('DOMContentLoaded', () => {
      preloadImages();
      writingWords.forEach(word => {
        const img = new Image();
        img.src = `img/${word.toLowerCase()}.jpeg`;
      });
    });
  </script>
</body>
</html>
